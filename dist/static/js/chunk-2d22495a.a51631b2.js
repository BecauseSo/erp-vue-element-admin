(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22495a"],{e180:function(e,a,s){"use strict";s.r(a);var t=function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("el-container",[s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.addUserLoading,expression:"addUserLoading"}],attrs:{"close-on-press-escape":!1,"element-loading-text":"添加中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)",title:"添加员工",visible:e.dialogTableVisible,center:"","append-to-body":!0,"lock-scroll":!1,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(a){e.dialogTableVisible=a}}},[s("section",[s("el-container",[s("el-form",{attrs:{"label-width":"120px"},model:{value:e.newUser,callback:function(a){e.newUser=a},expression:"newUser"}},[s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"名字",prop:"name"}},[s("el-input",{attrs:{clearable:""},model:{value:e.newUser.name,callback:function(a){e.$set(e.newUser,"name",a)},expression:"newUser.name"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"密码",prop:"password"}},[s("el-input",{attrs:{type:"password",clearable:""},model:{value:e.newUser.password,callback:function(a){e.$set(e.newUser,"password",a)},expression:"newUser.password"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"电话",prop:"phone"}},[s("el-input",{attrs:{type:"tel",clearable:""},model:{value:e.newUser.phone_number,callback:function(a){e.$set(e.newUser,"phone_number",a)},expression:"newUser.phone_number"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{attrs:{type:"email",clearable:""},model:{value:e.newUser.email,callback:function(a){e.$set(e.newUser,"email",a)},expression:"newUser.email"}})],1)],1)],1)],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(a){e.dialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.addUserConfirmBtnAction()}}},[e._v("添 加")])],1)],1)]),e._v(" "),s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.modifyUserApartLoading,expression:"modifyUserApartLoading"}],attrs:{"close-on-press-escape":!1,"element-loading-text":"修改中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)",title:"修改部门",visible:e.modifyUserApartsVisible,center:"","append-to-body":!0,"lock-scroll":!1,width:"30%","close-on-click-modal":!1},on:{close:function(a){return e.modifyUserGroupsClose()},"update:visible":function(a){e.modifyUserApartsVisible=a}}},[s("section",[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.selectUserAparts,border:""}},[s("el-table-column",{attrs:{prop:"group_display_name",label:"角色"}}),e._v(" "),s("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[s("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(s){return s.preventDefault(),e.deleteUserFromApart(a.$index,e.selectUserAparts)}}},[e._v("\n                                        移除\n                                ")])]}}])})],1)],1)]),e._v(" "),s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.modifyUserLoading,expression:"modifyUserLoading"}],attrs:{"close-on-press-escape":!1,"element-loading-text":"添加中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)",title:"修改员工信息",visible:e.modifyUserVisible,center:"","append-to-body":!0,"lock-scroll":!1,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(a){e.modifyUserVisible=a}}},[s("section",[s("el-container",[s("el-form",{attrs:{"label-width":"120px"},model:{value:e.modifyUser,callback:function(a){e.modifyUser=a},expression:"modifyUser"}},[s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"名字",prop:"name"}},[s("el-input",{attrs:{clearable:""},model:{value:e.modifyUser.name,callback:function(a){e.$set(e.modifyUser,"name",a)},expression:"modifyUser.name"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"电话",prop:"phone"}},[s("el-input",{attrs:{type:"tel",clearable:""},model:{value:e.modifyUser.phone_number,callback:function(a){e.$set(e.modifyUser,"phone_number",a)},expression:"modifyUser.phone_number"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{attrs:{type:"email",clearable:""},model:{value:e.modifyUser.email,callback:function(a){e.$set(e.modifyUser,"email",a)},expression:"modifyUser.email"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"角色"}},[e._l(e.modifyUser.groups.items,(function(a){return s("el-tag",{key:a.display_name,attrs:{closable:"","disable-transitions":!1},on:{close:function(s){return e.handleGroupDelete(a)}}},[e._v("\n                                    "+e._s(a.display_name)+"\n                                ")])})),e._v(" "),s("el-popover",{attrs:{trigger:"manual"},model:{value:e.addGroupCascaderVisible,callback:function(a){e.addGroupCascaderVisible=a},expression:"addGroupCascaderVisible"}},[s("el-cascader-panel",{ref:"addGroupCascader",attrs:{"show-all-levels":!1,props:e.groupProps,options:e.allRolesDisplay},on:{change:e.handleGroupChange}}),e._v(" "),s("el-button",{attrs:{slot:"reference"},on:{click:function(a){return e.showGroupInput()}},slot:"reference"},[e._v("+ New Tag")])],1)],2)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-form-item",{attrs:{label:"部门"}},[e._l(e.modifyUser.aparts.items,(function(a){return s("el-tag",{key:a.name,attrs:{closable:"","disable-transitions":!1},on:{close:function(s){return e.handleApartDelete(a)}}},[e._v("\n                                    "+e._s(a.name)+"\n                                ")])})),e._v(" "),s("el-popover",{attrs:{trigger:"manual"},model:{value:e.addApartCascaderVisible,callback:function(a){e.addApartCascaderVisible=a},expression:"addApartCascaderVisible"}},[s("el-cascader-panel",{ref:"addApartCascader",attrs:{"show-all-levels":!1,props:e.apartProps,options:e.apartDisplayData},on:{change:e.handleApartChange}}),e._v(" "),s("el-button",{attrs:{slot:"reference"},on:{click:function(a){return e.showApartInput()}},slot:"reference"},[e._v("+ New Tag")])],1)],2)],1)],1)],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(a){e.dialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(a){return e.modifyUserConfirmBtnAction()}}},[e._v("确 认")])],1)],1)]),e._v(" "),s("el-header",[s("el-button",{attrs:{type:"primary",round:""},on:{click:e.addBtnAction}},[e._v("添加员工")])],1),e._v(" "),s("el-main",[s("el-container",[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[s("el-table-column",{attrs:{prop:"id_str",label:"id"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e._v(" "),s("el-table-column",{attrs:{prop:"phone_number",label:"电话"}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e._v(" "),s("el-table-column",{attrs:{prop:"aparts.display",label:"部门"},scopedSlots:e._u([{key:"default",fn:function(a){return[s("span",[e._v(e._s(a.row.aparts.display))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"status",label:"状态"}}),e._v(" "),s("el-table-column",{attrs:{prop:"groups.display",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(a){return[s("span",[e._v(e._s(a.row.groups.display))])]}}])}),e._v(" "),s("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[s("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(s){return s.preventDefault(),e.deleteUserWithRow(a.$index,e.tableData)}}},[e._v("\n                                移除\n                        ")]),e._v(" "),s("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(s){return s.preventDefault(),e.modifyUserWithRow(a.$index,e.tableData)}}},[e._v("\n                                修改\n                        ")])]}}])})],1)],1)],1)],1)},i=[],r=(s("6b54"),s("7f7f"),s("ac6a"),s("c5f6"),s("bd86")),l={data:function(){var e;return{tableData:[],dialogTableVisible:!1,addUserLoading:!1,newUser:{name:"",password:"",phone_number:"",email:""},allRoles:{},allRolesDisplay:[],allApart:[],addUserRoleItemID:null,modifyUserGroupsVisible:!1,selectUserGroups:[],selectUser:null,modifyUserGroupsLoading:!1,apartDisplayData:null,modifyUserApartLoading:!1,modifyUserApartsVisible:!1,selectUserAparts:[],apartProps:{children:"sub",label:"apart_name",value:"id",checkStrictly:!0},groupProps:{children:"sub",label:"group_display_name",value:"id",checkStrictly:!0},currentApart:[],modifyUserLoading:!1,modifyUserVisible:!1,modifyUser:(e={name:"",email:"",phone_number:""},Object(r["a"])(e,"email",""),Object(r["a"])(e,"groups",{items:[]}),Object(r["a"])(e,"aparts",{items:[]}),e),modifyUserOrigin:null,addGroupCascaderVisible:!1,addApartCascaderVisible:!1}},components:{},props:{currentGroupId:{type:Number,default:null}},created:function(){this.reloadUsers()},methods:{reloadUsers:function(){var e=this;this.http.post("/user/all").then((function(a){e.tableData=[],a.data.forEach((function(a){for(var s=a["id"],t=a["name"],i=a["phone_number"],r=a["email"],l=a["role_list"],o=a["apart_list"],n=a["status"],d="",p=l.length,c=0;c<p;c++){var u=l[c];0!=d.length?d=d+","+u.display_name:d=u.display_name}for(var m=o.length,f="",h=0;h<m;h++){var b=o[h];console.log(b),0!=f.length?f=f+","+b.name:f=b.name}var g={id_str:s.toString(),id:s,name:t,email:r,phone_number:i,status:n,groups:{display:d,items:l},aparts:{display:f,items:o}};e.tableData.push(g)}))})).catch((function(a){e.$message({type:"info",message:a})}))},addBtnAction:function(e){var a=this;null!=this.allRolesDisplay&&0!=this.allRolesDisplay.length?this.dialogTableVisible=!0:this.loadAllRoles((function(){a.dialogTableVisible=!0}))},loadAllRoles:function(e){var a=this;this.http.post("/group/all").then((function(s){a.allRolesDisplay=s.data,s.data.forEach((function(e){var s=e["id"];a.allRoles[s]=e})),null!=e&&e()})).catch((function(a){null!=e&&e()}))},addUserConfirmBtnAction:function(e){if(console.log(this.newUser),null!=this.newUser.name&&0!=this.newUser.name.length)if(null!=this.newUser.password&&0!=this.newUser.password.length){var a={name:this.newUser.name,password:this.newUser.password,phone_number:this.newUser.phone_number,email:this.newUser.email};this.addUserLoading=!0;var s=this;this.http.post("/user/add",a).then((function(e){s.addUserLoading=!1,s.dialogTableVisible=!1,s.reloadUsers()})).catch((function(e){s.addUserLoading=!1,s.dialogTableVisible=!1,console.error(e)}))}else this.$message({type:"info",message:"密码不能为空"});else this.$message({type:"info",message:"名字不能为空"})},deleteUserWithRow:function(e,a){var s=a[e],t={user_id:s.id},i=this;1!=s.status&&this.http.post("/user/delete",t).then((function(e){i.reloadUsers()})).catch((function(e){console.error(e)}))},loadAllAparts:function(e){var a=this;this.http.post("/apart/all").then((function(s){var t=s.data;console.log(t);var i=t.length;if(0==i)return[];for(var r={},l=0;l<i;l++){var o=t[l],n=r[o.parent_id];null==n?r[o.parent_id]=[o]:n.push(o)}for(var d=r[0],p=d.length,c=0;c<p;c++){var u=d[c];u["sub"]=a.subApartsFor(u,r)}a.apartDisplayData=d,e&&e()})).catch((function(a){e&&e()}))},subApartsFor:function(e,a){var s=a[e.id];if(null==s||0==s.length)return[];for(var t=s.length,i=0;i<t;i++){var r=s[i],l=this.subApartsFor(r,a);l.length>0&&(r["sub"]=l)}return s},modifyUserWithRow:function(e,a){var s=a[e];this.modifyUserOrigin=s,this.modifyUser.name=s.name,this.modifyUser.phone_number=s.phone_number,this.modifyUser.email=s.email,this.modifyUser.groups.items=s.groups.items.slice(0),this.modifyUser.aparts.items=s.aparts.items.slice(0),this.modifyUserVisible=!0},modifyUserConfirmBtnAction:function(){var e=[],a=this;this.modifyUser.groups.items.forEach((function(s){for(var t=!0,i=0;i<a.modifyUserOrigin.groups.items.length;i++){var r=a.modifyUserOrigin.groups.items[i];if(s.id==r.id){t=!1;break}}1==t&&e.push(s)}));var s=[];this.modifyUserOrigin.groups.items.forEach((function(e){for(var t=!0,i=0;i<a.modifyUser.groups.items.length;i++){var r=a.modifyUser.groups.items[i];if(e.id==r.id){t=!1;break}}1==t&&s.push(e)}));for(var t=[],i=0;i<e.length;i++){var r=e[i],l={group_id:r.id,user_id:this.modifyUserOrigin.id};t.push(l)}for(var o=[],n=0;n<s.length;n++){var d=s[n],p={group_id:d.id,user_id:this.modifyUserOrigin.id};o.push(p)}var c=[];this.modifyUser.aparts.items.forEach((function(e){for(var s=!0,t=0;t<a.modifyUserOrigin.aparts.items.length;t++){var i=a.modifyUserOrigin.aparts.items[t];if(e.id==i.id){s=!1;break}}1==s&&c.push(e)}));var u=[];this.modifyUserOrigin.aparts.items.forEach((function(e){for(var s=!0,t=0;t<a.modifyUser.aparts.items.length;t++){var i=a.modifyUser.aparts.items[t];if(e.id==i.id){s=!1;break}}1==s&&u.push(e)}));for(var m=[],f=0;f<c.length;f++){var h=c[f],b={apart_id:h.id,user_id:this.modifyUserOrigin.id};m.push(b)}for(var g=[],y=0;y<u.length;y++){var v=u[y],U={apart_id:v.id,user_id:this.modifyUserOrigin.id};g.push(U)}var _=this.modifyUser.name,w=null==this.modifyUser.email||0==this.modifyUser.email.length?"":this.modifyUser.email,k=null==this.modifyUser.phone_number||0==this.modifyUser.phone_number.length?"":this.modifyUser.phone_number;if(null!=_&&0!=_.length){var A={id:this.modifyUserOrigin.id,name:_,email:w,phone_number:k,groupaddlist:t,groupdeletelist:o,apartaddlist:m,apartdeletelist:g};this.modifyUserGroupsLoading=!0,this.http.post("/user/modify",A).then((function(e){a.reloadUsers(),a.$message({type:"success",message:"修改员工权限成功"}),a.modifyUserGroupsLoading=!1,a.modifyUserVisible=!1})).catch((function(e){a.$message({type:"info",message:"修改员工权限失败"}),a.modifyUserGroupsLoading=!1,a.modifyUserVisible=!1}))}else this.$message({type:"error",message:"员工姓名不能为空"})},showGroupInput:function(){if(this.allRolesDisplay.length>0)this.addGroupCascaderVisible=!this.addGroupCascaderVisible;else{var e=this;this.loadAllRoles((function(){e.addGroupCascaderVisible=!e.addGroupCascaderVisible}))}},showApartInput:function(){if(this.allApart.length>0)this.addApartCascaderVisible=!this.addApartCascaderVisible;else{var e=this;this.loadAllAparts((function(){e.addApartCascaderVisible=!e.addApartCascaderVisible}))}},handleGroupDelete:function(e){this.modifyUser.groups.items.splice(this.modifyUser.groups.items.indexOf(e),1)},handleApartDelete:function(e){this.modifyUser.aparts.items.splice(this.modifyUser.aparts.items.indexOf(e),1)},handleApartChange:function(e){if(this.addApartCascaderVisible=!1,0!=e.length){for(var a=this.$refs.addApartCascader.getCheckedNodes()[0].data,s=!0,t=0;t<this.modifyUser.aparts.items.length;t++){var i=this.modifyUser.aparts.items[t];if(i.id==a.id){s=!1;break}}if(1==s){var r={id:a.id,name:a.apart_name};this.modifyUser.aparts.items.push(r)}else this.$message({type:"info",message:"请勿重复添加"});this.$refs.addApartCascader.clearCheckedNodes()}},handleGroupChange:function(e){if(this.addGroupCascaderVisible=!1,0!=e.length){for(var a=this.$refs.addGroupCascader.getCheckedNodes()[0].data,s=!0,t=0;t<this.modifyUser.groups.items.length;t++){var i=this.modifyUser.groups.items[t];if(i.id==a.id){s=!1;break}}if(1==s){console.log(a);var r={display_name:a.group_display_name,name:a.group_name,id:a.id};this.modifyUser.groups.items.push(r)}else this.$message({type:"info",message:"请勿重复添加"});this.$refs.addGroupCascader.clearCheckedNodes()}}}},o=l,n=s("2877"),d=Object(n["a"])(o,t,i,!1,null,null,null);a["default"]=d.exports}}]);